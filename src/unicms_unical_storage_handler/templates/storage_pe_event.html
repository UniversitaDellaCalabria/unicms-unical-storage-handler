{% extends this_string_will_be_replaced %}

{% load i18n %}
{% load static %}

<!-- load custom template tags -->
{% load unicms_contexts %}
{% load unicms_storage_handler %}
{% load unicms_templates %}

<!-- SEO  -->
{% block page_title %}{% trans "Event" %}{% endblock page_title %}

{% block container %}
{% random_id uid as id %}
{% get_current_language as LANGUAGE_CODE %}
{% storage_settings_value "BREADCRUMB_LAST" as breadcrumb_last %}
{% breadcrumbs webpath=webpath leaf=handler %}
{% split_string s=handler.breadcrumbs.0.0 c='/' as sub_path %}

<div id="{{ id }}" class="container">
    <div class="col-12 py-5 bd-content">
        {% block centered_container %}
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <loading-icon v-if="is_loading" :loader_source="loader_source">
                    </loading-icon>
                    
                    <div v-else-if="Object.keys(item).length">
                        
                        <div class="row">
                            <div class="col-12">
                                <h1 class="lighter">
                                    [[ item.title ]]
                                </h1>
                                <h4 class="lighter" v-if="item.type">
                                    [[ item.type ]]
                                </h4>
                                <p v-if="item.description">
                                    [[ item.description ]]
                                </p>
                                <p>
                                    {% trans "From" %}: 
                                    [[ new Date(item.start).toLocaleString("{{ LANGUAGE_CODE }}",
                                    {day: '2-digit',
                                    month: '2-digit',
                                    year: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'})]]
                                    -
                                    {% trans "To" %}: 
                                    [[ new Date(item.end).toLocaleString("{{ LANGUAGE_CODE }}",
                                    {day: '2-digit',
                                    month: '2-digit',
                                    year: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'})]]
                                </p>
                            </div>
                        </div>
                        <hr class="my-4 bordeaux-unical-bg">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover table-striped">
                                <tbody>
                                    <tr>
                                        <td>{% trans "Structure" %}</td>
                                        <td>[[ item.structure ]]</td>
                                    </tr>
                                    <tr>
                                        <td>{% trans "Referent" %}</td>
                                        <td>[[ item.referent ]]</td>
                                    </tr>
                                    <tr v-if="item.geographical_dimension">
                                        <td>{% trans "Geographical dimension" %}</td>
                                        <td>[[ item.geographical_dimension ]]</td>
                                    </tr>
                                    <tr v-if="item.recipients.length">
                                        <td>{% trans "Recipients" %}</td>
                                        <td>
                                            <ul>
                                                <li v-for="recipient in item.recipients">
                                                    [[ recipient ]]
                                                </li>
                                                <li v-if="item.other_recipients">
                                                    [[ item.other_recipients ]]
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                    <tr v-if="item.organizing_subject">
                                        <td>{% trans "Organizing subject" %}</td>
                                        <td>[[ item.organizing_subject ]]</td>
                                    </tr>
                                    <tr v-if="item.goals.length">
                                        <td>{% trans "Goals" %}</td>
                                        <td>
                                            <ul>
                                                <li v-for="goal in item.goals">
                                                    [[ goal ]]
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                    <tr v-if="item.involved_personnel.length">
                                        <td>{% trans "Involved personnel" %}</td>
                                        <td>
                                            <ul>
                                                <li v-for="personnel in item.involved_personnel">
                                                    [[ personnel ]]
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                    <tr v-if="item.involved_structures.length">
                                        <td>{% trans "Involved structures" %}</td>
                                        <td>
                                            <ul>
                                                <li v-for="structure in item.involved_structures">
                                                    [[ structure ]]
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div v-else>
                        {% include "includes/unical_storage_empty.html" with url=url %}
                    </div>
                </div>
            </div>
        </div>
        {% endblock %}
    </div>
</div>
<script>
    var {{ id }} = new Vue({
        el: '#{{ id }}',
        data() {
            return {
                item: {},
                labels: {},
                url: '{{ url }}?lang={{ LANGUAGE_CODE }}',
                is_loading: true,
                loader_source: '{{ url }}',
            }
        },
        mounted() {
            this.CallURL();
        },
        methods: {
            containsHTML(s) {
                return /<\/?[a-z][\s\S]*>/i.test(s)
            },
            CallURL() {
                axios
                .get(this.url)
                .then(response => {
                    this.item = response.data;
                    this.is_loading = false
                    document.getElementsByClassName("{{ breadcrumb_last }}")[0].innerHTML = this.item.title
                    document.title = this.item.title
                })
            }
        }
    })
</script>
{% endblock container %}

