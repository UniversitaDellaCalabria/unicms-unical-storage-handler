{% load i18n %}
{% load static %}
{% load unicms_storage_handler %}
{% load unicms_templates %}

{% get_current_language as LANGUAGE_CODE %}
{% random_id as id %}

{% include "includes/unical_storage_loading.html" %}


<div id="{{ id }}">

    <loading-icon
        v-if="is_loading"
        :loader_source="loader_source">
    </loading-icon>

    <div v-else>

        <div class="bd-example-tabs">
            <ul class="nav nav-tabs" id="myTab-{{ id }}" role="tablist">
                <li v-for="(item, index) in items.results"
                    class="nav-item">
                    <a :class="index == 0 ? 'nav-link active' : 'nav-link'"
                       :id="'tab-{{ id }}-' + index + '-tab'"
                       data-toggle="tab"
                       :href="'#tab-{{ id }}-' + index"
                       role="tab"
                       :aria-controls="'tab-{{ id }}-' + index"
                       :aria-selected="index == 0 ? 'true' : 'false'">
                        [[ item.StudyPlanName ]]
                    </a>
                </li>
            </ul>
            <div class="tab-content" id="myTab-{{ id }}Content">
                <div v-for="(item, index) in items.results"
                     :class="index == 0 ? 'tab-pane p-4 fade fade show active' : 'tab-pane p-4 fade fade'"
                     :id="'tab-{{ id }}-' + index"
                     role="tabpanel"
                     :aria-labelledby="'tab-{{ id }}-' + index + '-tab'">

                    <div v-for="(value, label, index2) in item.StudyActivities"
                         :id="'collapseDiv{{ id }}-' + index + '-lft'"
                         class="collapse-div collapse-left-icon"
                         role="tablist">
                        <div class="collapse-header"
                             :id="'heading-{{ id }}-' + index + index2 + '-lft'">
                            <button data-toggle="collapse"
                                    :data-target="'#collapse-{{ id }}-' + index + index2 +'-lft'"
                                    aria-expanded="false"
                                    :aria-controls="'collapse-{{ id }}-' + index + index2 +'-lft'">
                            [[ label ]] {% trans "anno" %}
                            </button>
                        </div>
                        <div :id="'collapse-{{ id }}-' + index + index2 +'-lft'"
                             class="collapse"
                             role="tabpanel"
                             :aria-labelledby="'heading-{{ id }}-' + index + index2 + '-lft'">
                            <div class="collapse-body">
                                <div class="it-list-wrapper">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th scope="col">[[ items.labels.StudyActivityName ]]</th>
                                                    <th scope="col">[[ items.labels.StudyActivitySemester ]]</th>
                                                    <th scope="col">[[ items.labels.StudyActivityECTS ]]</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr v-for="activity in value">
                                                    <td>
                                                        {% settings_value "CMS_PATH_PREFIX" as cms_path_prefix %}
                                                        {% settings_value "CMS_STORAGE_BASE_PATH" as base_prefix %}
                                                        {% settings_value "CMS_STORAGE_CDS_VIEW_PREFIX_PATH" as cds_prefix %}
                                                        {% settings_value "CMS_STORAGE_ACTIVITY_VIEW_PREFIX_PATH" as activity_prefix %}
                                                        <a :href="'/{{ cms_path_prefix }}{{ base_prefix }}/{{ cds_prefix }}/' + [[ activity.StudyActivityRegDidId ]] + '/{{ activity_prefix }}/' + [[ activity.StudyActivityID ]] +'/'">
                                                            [[ activity.StudyActivityName ]]
                                                            <span v-if="items.StudyActivityCompulsory == 1">*</span>
                                                        </a>
                                                    </td>
                                                    <td>[[ activity.StudyActivitySemester ]]</td>
                                                    <td>[[ activity.StudyActivityECTS ]]</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
var {{ id }} = new Vue({
    el: '#{{ id }}',
    data() {
        return {
            parameters: "",
            items: [],
            labels: [],
            url: '{{ url }}',
            next_page: "",
            previous_page: "",
            args_input: false,
            is_loading: true,
            loader_source: '{{ url }}',
        }
    },
    mounted() {
        this.CallURL(this.url + this.parameters);

        let url_splitted = this.url.split("?");
        if (url_splitted == this.url)
            this.args_input = false
        else
            this.args_input = true
    },
    methods: {
        search() {
            this.parameters = encodeQueryData(get_form_paramenters(), this.args_input);
            this.CallURL(this.url + this.parameters);
        },
        CallURL(url) {
            axios
                .get(url)
                .then(response => {
                    this.items = response.data;
                    this.next_page = response.data.next;
                    this.previous_page = response.data.previous;
                    this.labels = response.data.labels;
                    this.is_loading = false
                })
        },
    }
})
</script>

